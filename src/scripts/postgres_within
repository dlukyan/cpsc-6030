#!/bin/bash
cat /mnt/$1 | sed 1d > /mnt/$1_headless.csv
psql -U postgres -c "create role dvproject login password 'password';"
psql -U postgres -c "create database dvproject;"
psql -U postgres -c "alter database dvproject owner to dvproject;"
psql -U postgres -d dvproject -c "create schema dvproject; alter schema dvproject owner to dvproject;"
psql -U postgres -d dvproject -c "set search_path to dvproject; create table data (name varchar(1024), age int, gender varchar(32), race varchar(128), victim_image text, date date, street_address varchar(1024), city varchar(128), state varchar(4), zip varchar(8), county varchar(128), agency_responsible varchar(256), ori varchar(128), cause_of_death varchar(128), circumstances varchar(4096), disposition_official varchar(1024), officer_charged varchar(128), news_url varchar(4096), signs_of_mental_illness varchar(64), allegedly_armed varchar(128), wapo_armed varchar(128), wapo_threat_level varchar(128), wapo_flee varchar(32), wapo_body_camera varchar(32), wapo_id int, off_duty_killing varchar(64), georgaphy varchar(64), mpv_id int, fe_id int, encounter_type varchar(128), initial_reason varchar(4096), officer_names varchar(4096), officer_races varchar(256), officer_known_past_shootings varchar(4096), call_for_service varchar(16), tract int, urban_rural_upsai varchar(32), urban_rural_nchs varchar(32), hhincome_median_census_tract int, latitude float, longitude float, pop_total_census_tract float, pop_white_census_tract float, pop_black_census_tract float, pop_native_american_census_tract float, pop_asian_census_tract float, pop_pacific_islander_census_tract float, pop_other_multiple_census_tract float, pop_hispanic_census_tract float, congressional_district_113 varchar(8), congressperson_lastname varchar(128), congressperson_firstname varchar(128), congressperson_party varchar(32), prosecutor_head varchar(128), prosecutor_race varchar(16), prosecutor_gender varchar(128), prosecutor_party varchar(128), prosecutor_term varchar(128), prosecutor_in_court varchar(128), prosecutor_special varchar(128), independent_investigation varchar(128), prosecutor_url varchar(4096)); copy data from '/mnt/police_violence_cleaned_headless.csv' with (format csv);"
psql -U postgres -d dvproject -c "grant all privileges on all tables in schema dvproject to dvproject;"